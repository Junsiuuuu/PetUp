<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>환경 설정</title>
    <style>
        /* --- [디자인 스타일] --- */
        body { 
            font-family: 'Malgun Gothic', sans-serif; 
            padding: 15px; 
            background: #f7f7f7; 
            user-select: none; 
            overflow: hidden;
        }
        
        h2 { 
            margin-top: 0; 
            color: #333; 
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        /* 설정 항목 박스 디자인 */
        .control-group { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
        }
        
        label { 
            display: block; 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: #444; 
            font-size: 14px;
        }
        
        /* 가로 배치용 (슬라이더 + 숫자) */
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 슬라이더 스타일 */
        input[type="range"] { 
            flex-grow: 1; 
            cursor: pointer; 
            height: 4px;
        }
        
        /* 숫자 입력칸 스타일 */
        input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
        }

        /* 선택 박스 스타일 */
        select { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 13px;
        }

        /* 설명 텍스트 */
        .desc { 
            font-size: 11px; 
            color: #999; 
            margin-top: 5px; 
            line-height: 1.2;
        }

        /* [NEW] 펫 켜기/끄기 체크박스 스타일 */
        .checkbox-row {
            display: flex;
            align-items: center;
            justify-content: space-between; /* 양끝 정렬 */
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        
        .checkbox-label {
            font-size: 13px;
            color: #555;
            font-weight: normal;
            margin: 0;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4CAF50; /* 체크 색상 초록색 */
        }

        /* 버튼 그룹 (하단) */
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
        }

        #save-btn { background: #4CAF50; color: white; } /* 초록색 */
        #save-btn:hover { background: #45a049; }

        #close-btn { background: #e0e0e0; color: #333; } /* 회색 */
        #close-btn:hover { background: #d0d0d0; }

        /* 알림 팝업 (Toast) 스타일 */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #ffebec;
            color: #d8000c;
            border: 1px solid #d8000c;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show { visibility: visible; opacity: 1; bottom: 40px; }
        #toast.success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #2e7d32; }
    </style>
</head>
<body>
    <h2>⚙️ 환경 설정</h2>

    <div class="control-group">
        <label>캐릭터 설정</label>
        <select id="char-select">
            <option value="pig">돼지</option>
            <option value="cat">고양이</option>
            <option value="dog">강아지</option>
            <option value="monkey">원숭이</option>
            <option value="elephant">코끼리</option>
        </select>
        
        <div class="checkbox-row">
            <span class="checkbox-label">바탕화면에 캐릭터 표시</span>
            <input type="checkbox" id="pet-toggle">
        </div>
    </div>

    <div class="control-group">
        <label>말풍선 빈도 (초)</label>
        <div class="input-row">
            <input type="range" id="freq-range" min="3" max="300">
            <input type="number" id="freq-number" min="3" max="300">
        </div>
        <p class="desc">최소 3초 ~ 최대 300초 (5분)</p>
    </div>

    <div class="control-group">
        <label>효과음 볼륨 (%)</label>
        <div class="input-row">
            <input type="range" id="vol-range" min="0" max="100">
            <input type="number" id="vol-number" min="0" max="100">
        </div>
        <p class="desc">0%로 설정하면 소리가 나지 않습니다.</p>
    </div>

    <div class="button-group">
        <button id="close-btn">닫기</button>
        <button id="save-btn">저장</button>
    </div>

    <div id="toast">알림 메시지</div>

    <script>
        const { ipcRenderer } = require('electron');

        // 요소 가져오기
        const charSelect = document.getElementById('char-select');
        const petToggle = document.getElementById('pet-toggle'); // [NEW] 체크박스
        
        const freqRange = document.getElementById('freq-range');
        const freqNumber = document.getElementById('freq-number');
        
        const volRange = document.getElementById('vol-range');
        const volNumber = document.getElementById('vol-number');

        const saveBtn = document.getElementById('save-btn');
        const closeBtn = document.getElementById('close-btn');
        const toast = document.getElementById('toast');

        // --- 1. 초기값 받아오기 (앱 켜질 때) ---
        ipcRenderer.on('init-settings', (event, config) => {
            charSelect.value = config.character;
            petToggle.checked = config.showPet; // [NEW] 체크 상태 반영

            // 빈도 (밀리초 -> 초)
            const seconds = config.interval / 1000;
            freqRange.value = seconds;
            freqNumber.value = seconds;

            // 볼륨
            volRange.value = config.soundVolume;
            volNumber.value = config.soundVolume;
        });

        // --- 2. 동기화 함수 (슬라이더 <-> 숫자) ---
        function syncInputs(source, target) {
            target.value = source.value;
        }

        freqRange.addEventListener('input', () => syncInputs(freqRange, freqNumber));
        freqNumber.addEventListener('input', () => syncInputs(freqNumber, freqRange));

        volRange.addEventListener('input', () => syncInputs(volRange, volNumber));
        volNumber.addEventListener('input', () => syncInputs(volNumber, volRange));


        // --- 3. 저장 버튼 클릭 (유효성 검사 & 전송) ---
        saveBtn.addEventListener('click', () => {
            const freqVal = parseInt(freqNumber.value);
            const volVal = parseInt(volNumber.value);

            // 유효성 검사: 빈도 (3 ~ 300)
            if (isNaN(freqVal) || freqVal < 3 || freqVal > 300) {
                showToast("⚠️ 빈도는 3초에서 300초 사이여야 합니다!", false);
                freqNumber.focus(); 
                return;
            }

            // 유효성 검사: 볼륨 (0 ~ 100)
            if (isNaN(volVal) || volVal < 0 || volVal > 100) {
                showToast("⚠️ 볼륨은 0%에서 100% 사이여야 합니다!", false);
                volNumber.focus();
                return;
            }

            // 통과! -> 메인 프로세스로 전송
            ipcRenderer.send('update-config', {
                character: charSelect.value,
                showPet: petToggle.checked, // [NEW] 체크박스 값(true/false) 전송
                interval: freqVal * 1000,   // 초 -> 밀리초 변환
                soundVolume: volVal
            });

            showToast("✅ 설정이 저장되었습니다!", true);
        });

        // --- 4. 닫기 버튼 ---
        closeBtn.addEventListener('click', () => {
            window.close();
        });

        // --- 5. 알림 메시지 함수 ---
        function showToast(message, isSuccess) {
            toast.innerText = message;
            toast.className = "show"; 
            
            if (isSuccess) {
                toast.classList.add("success");
            }

            setTimeout(() => { 
                toast.className = toast.className.replace("show", ""); 
            }, 3000);
        }
    </script>
</body>
</html>