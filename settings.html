<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>í™˜ê²½ ì„¤ì •</title>
    <style>
        /* --- [ë””ìì¸ ìŠ¤íƒ€ì¼] --- */
        body { 
            font-family: 'Malgun Gothic', sans-serif; 
            padding: 15px; 
            background: #f7f7f7; 
            user-select: none; 
            overflow: hidden;
        }
        
        h2 { 
            margin-top: 0; 
            color: #333; 
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        /* ì„¤ì • í•­ëª© ë°•ìŠ¤ ë””ìì¸ */
        .control-group { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
        }
        
        label { 
            display: block; 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: #444; 
            font-size: 14px;
        }
        
        /* ê°€ë¡œ ë°°ì¹˜ìš© (ìŠ¬ë¼ì´ë” + ìˆ«ì) */
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
        input[type="range"] { 
            flex-grow: 1; 
            cursor: pointer; 
            height: 4px;
        }
        
        /* ìˆ«ì ì…ë ¥ì¹¸ ìŠ¤íƒ€ì¼ */
        input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
        }

        /* ì„ íƒ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        select { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 13px;
        }

        /* ì„¤ëª… í…ìŠ¤íŠ¸ */
        .desc { 
            font-size: 11px; 
            color: #999; 
            margin-top: 5px; 
            line-height: 1.2;
        }

        /* [NEW] í« ì¼œê¸°/ë„ê¸° ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checkbox-row {
            display: flex;
            align-items: center;
            justify-content: space-between; /* ì–‘ë ì •ë ¬ */
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        
        .checkbox-label {
            font-size: 13px;
            color: #555;
            font-weight: normal;
            margin: 0;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4CAF50; /* ì²´í¬ ìƒ‰ìƒ ì´ˆë¡ìƒ‰ */
        }

        /* ë²„íŠ¼ ê·¸ë£¹ (í•˜ë‹¨) */
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
        }

        #save-btn { background: #4CAF50; color: white; } /* ì´ˆë¡ìƒ‰ */
        #save-btn:hover { background: #45a049; }

        #close-btn { background: #e0e0e0; color: #333; } /* íšŒìƒ‰ */
        #close-btn:hover { background: #d0d0d0; }

        /* ì•Œë¦¼ íŒì—… (Toast) ìŠ¤íƒ€ì¼ */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #ffebec;
            color: #d8000c;
            border: 1px solid #d8000c;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show { visibility: visible; opacity: 1; bottom: 40px; }
        #toast.success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #2e7d32; }
    </style>
</head>
<body>
    <h2>âš™ï¸ í™˜ê²½ ì„¤ì •</h2>

    <div class="control-group">
        <label>ìºë¦­í„° ì„¤ì •</label>
        <select id="char-select">
            <option value="pig">ë¼ì§€</option>
            <option value="cat">ê³ ì–‘ì´</option>
            <option value="dog">ê°•ì•„ì§€</option>
            <option value="monkey">ì›ìˆ­ì´</option>
            <option value="elephant">ì½”ë¼ë¦¬</option>
            <option value="goose">ê±°ìœ„</option>
        </select>
        
        <div class="checkbox-row">
            <span class="checkbox-label">ë°”íƒ•í™”ë©´ì— ìºë¦­í„° í‘œì‹œ</span>
            <input type="checkbox" id="pet-toggle">
        </div>
    </div>

    <div class="control-group">
        <label>ìƒì¼ (Birthday) ğŸ‚</label>
        <div class="birth-row" style="display: flex; gap: 10px; align-items: center;">
            <select id="birth-month" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center;">
                <option value="0">ì„ íƒ ì•ˆ í•¨</option>
                </select>
            <span>ì›”</span>
            <select id="birth-day" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; text-align: center;">
                <option value="0">ì„ íƒ ì•ˆ í•¨</option>
                </select>
            <span>ì¼</span>
        </div>
        <p class="desc">ìƒì¼ì´ ë˜ë©´ ìºë¦­í„°ê°€ ì¶•í•˜í•´ì¤ë‹ˆë‹¤!</p>
    </div>

    <div class="control-group">
        <label>ë§í’ì„  ë¹ˆë„ (ì´ˆ)</label>
        <div class="input-row">
            <input type="range" id="freq-range" min="3" max="300">
            <input type="number" id="freq-number" min="3" max="300">
        </div>
        <p class="desc">ìµœì†Œ 3ì´ˆ ~ ìµœëŒ€ 300ì´ˆ (5ë¶„)</p>
    </div>

    <div class="control-group">
        <label>íš¨ê³¼ìŒ ë³¼ë¥¨ (%)</label>
        <div class="input-row">
            <input type="range" id="vol-range" min="0" max="100">
            <input type="number" id="vol-number" min="0" max="100">
        </div>
        <p class="desc">0%ë¡œ ì„¤ì •í•˜ë©´ ì†Œë¦¬ê°€ ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="button-group">
        <button id="close-btn">ë‹«ê¸°</button>
        <button id="save-btn">ì €ì¥</button>
    </div>

    <div id="toast">ì•Œë¦¼ ë©”ì‹œì§€</div>

    <script>
        const { ipcRenderer } = require('electron');

        // ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const charSelect = document.getElementById('char-select');
        const petToggle = document.getElementById('pet-toggle'); // [NEW] ì²´í¬ë°•ìŠ¤
        
        const freqRange = document.getElementById('freq-range');
        const freqNumber = document.getElementById('freq-number');
        
        const volRange = document.getElementById('vol-range');
        const volNumber = document.getElementById('vol-number');

        const saveBtn = document.getElementById('save-btn');
        const closeBtn = document.getElementById('close-btn');
        const toast = document.getElementById('toast');

        const birthMonth = document.getElementById('birth-month');
        const birthDay = document.getElementById('birth-day');

        // [ì¶”ê°€] 1ì›”~12ì›”, 1ì¼~31ì¼ ì˜µì…˜ ìë™ ìƒì„±
        for(let i=1; i<=12; i++) {
            let option = document.createElement('option');
            option.value = i; option.text = i;
            birthMonth.appendChild(option);
        }
        for(let i=1; i<=31; i++) {
            let option = document.createElement('option');
            option.value = i; option.text = i;
            birthDay.appendChild(option);
        }

        // --- 1. ì´ˆê¸°ê°’ ë°›ì•„ì˜¤ê¸° (ì•± ì¼œì§ˆ ë•Œ) ---
        ipcRenderer.on('init-settings', (event, config) => {
            charSelect.value = config.character;
            petToggle.checked = config.showPet; // [NEW] ì²´í¬ ìƒíƒœ ë°˜ì˜

            if (config.birthday) {
                birthMonth.value = config.birthday.month || 0;
                birthDay.value = config.birthday.day || 0;
            }

            // ë¹ˆë„ (ë°€ë¦¬ì´ˆ -> ì´ˆ)
            const seconds = config.interval / 1000;
            freqRange.value = seconds;
            freqNumber.value = seconds;

            // ë³¼ë¥¨
            volRange.value = config.soundVolume;
            volNumber.value = config.soundVolume;
        });

        // --- 2. ë™ê¸°í™” í•¨ìˆ˜ (ìŠ¬ë¼ì´ë” <-> ìˆ«ì) ---
        function syncInputs(source, target) {
            target.value = source.value;
        }

        freqRange.addEventListener('input', () => syncInputs(freqRange, freqNumber));
        freqNumber.addEventListener('input', () => syncInputs(freqNumber, freqRange));

        volRange.addEventListener('input', () => syncInputs(volRange, volNumber));
        volNumber.addEventListener('input', () => syncInputs(volNumber, volRange));


        // --- 3. ì €ì¥ ë²„íŠ¼ í´ë¦­ (ìœ íš¨ì„± ê²€ì‚¬ & ì „ì†¡) ---
        saveBtn.addEventListener('click', () => {
            const freqVal = parseInt(freqNumber.value);
            const volVal = parseInt(volNumber.value);

            // ìœ íš¨ì„± ê²€ì‚¬: ë¹ˆë„ (3 ~ 300)
            if (isNaN(freqVal) || freqVal < 3 || freqVal > 300) {
                showToast("âš ï¸ ë¹ˆë„ëŠ” 3ì´ˆì—ì„œ 300ì´ˆ ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤!", false);
                freqNumber.focus(); 
                return;
            }

            // ìœ íš¨ì„± ê²€ì‚¬: ë³¼ë¥¨ (0 ~ 100)
            if (isNaN(volVal) || volVal < 0 || volVal > 100) {
                showToast("âš ï¸ ë³¼ë¥¨ì€ 0%ì—ì„œ 100% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤!", false);
                volNumber.focus();
                return;
            }

            // í†µê³¼! -> ë©”ì¸ í”„ë¡œì„¸ìŠ¤ë¡œ ì „ì†¡
            ipcRenderer.send('update-config', {
                character: charSelect.value,
                showPet: petToggle.checked, // [NEW] ì²´í¬ë°•ìŠ¤ ê°’(true/false) ì „ì†¡
                birthday: {
                    month: parseInt(birthMonth.value),
                    day: parseInt(birthDay.value)
                },
                interval: freqVal * 1000,   // ì´ˆ -> ë°€ë¦¬ì´ˆ ë³€í™˜
                soundVolume: volVal
            });

            showToast("âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!", true);
        });

        // --- 4. ë‹«ê¸° ë²„íŠ¼ ---
        closeBtn.addEventListener('click', () => {
            window.close();
        });

        // --- 5. ì•Œë¦¼ ë©”ì‹œì§€ í•¨ìˆ˜ ---
        function showToast(message, isSuccess) {
            toast.innerText = message;
            toast.className = "show"; 
            
            if (isSuccess) {
                toast.classList.add("success");
            }

            setTimeout(() => { 
                toast.className = toast.className.replace("show", ""); 
            }, 3000);
        }
    </script>
</body>
</html>